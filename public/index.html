<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Drone Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="topbar" role="banner">
    <div class="toolbar">
      <div class="row">
        <button id="configBtn" class="btn icon-btn" aria-haspopup="dialog" aria-expanded="false" aria-controls="configPanel" title="Open settings">⚙️</button>
        <h1><span id="appTitle">Drone</span> Tracker</h1>
      </div>
      <div class="subtitle">Per show run data entry. Backed by Express API with modular storage.</div>
    </div>
  </div>

  <div id="configPanel" class="config" role="dialog" aria-modal="true" aria-labelledby="configTitle">
    <div class="toolbar">
      <h2 id="configTitle">Application settings</h2>
      <button id="closeConfig" class="btn icon-btn" title="Close settings">✖️</button>
    </div>
    <form id="configForm" class="grid">
      <div class="col-12">
        <label for="unitLabelSelect">Unit label</label>
        <select id="unitLabelSelect" name="unitLabel">
          <option value="Drone">Drone</option>
          <option value="Monkey">Monkey</option>
        </select>
        <p class="help">Controls how units are referenced across the UI.</p>
      </div>
      <div class="col-12">
        <label for="providerSelect">Storage provider</label>
        <select id="providerSelect" name="provider">
          <option value="sql">SQL (SQLite)</option>
          <option value="coda">Coda Table</option>
        </select>
      </div>
      <fieldset id="sqlFields" class="col-12 provider-fields">
        <legend>SQL configuration</legend>
        <label for="sqlFilename">SQLite database file</label>
        <input id="sqlFilename" type="text" placeholder="data/monkey-tracker.sqlite" />
        <p class="help">The server will create the file if it does not exist.</p>
      </fieldset>
      <fieldset id="codaFields" class="col-12 provider-fields">
        <legend>Coda configuration</legend>
        <label for="codaToken">API token</label>
        <input id="codaToken" type="password" autocomplete="off" placeholder="Coda API token" />
        <label for="codaDoc">Doc ID</label>
        <input id="codaDoc" type="text" autocomplete="off" placeholder="doc_XXXX" />
        <label for="codaTable">Table ID</label>
        <input id="codaTable" type="text" autocomplete="off" placeholder="table_XXXX" />
        <label for="codaShowId">Show ID column name</label>
        <input id="codaShowId" type="text" autocomplete="off" placeholder="Show ID" />
        <label for="codaPayload">Payload column name</label>
        <input id="codaPayload" type="text" autocomplete="off" placeholder="Payload" />
        <p class="help">The payload column should be a text field used to store JSON.</p>
      </fieldset>
      <div class="col-12 row" style="justify-content: flex-end; gap: 10px;">
        <button type="button" id="cancelConfig" class="btn ghost">Cancel</button>
        <button type="submit" class="btn primary">Save settings</button>
      </div>
      <div class="col-12">
        <div id="configMessage" role="status" aria-live="polite" class="help"></div>
      </div>
    </form>
  </div>

  <div class="container" role="main">
    <section class="panel" aria-labelledby="showHeaderTitle">
      <h2 id="showHeaderTitle">Show header</h2>
      <div class="grid">
        <div class="col-3">
          <label for="showDate">Date</label>
          <input id="showDate" type="date" autocomplete="off" />
        </div>
        <div class="col-3">
          <label for="showTime">Show start time</label>
          <input id="showTime" type="time" />
        </div>
        <div class="col-6">
          <label for="showLabel">Show label or number</label>
          <input id="showLabel" type="text" placeholder="e.g., 7pm Main" />
        </div>
        <div class="col-6">
          <label>Crew on duty <span class="help">(press Enter to add name)</span></label>
          <div id="crewInput" class="chip-input" aria-label="Crew on duty input"></div>
        </div>
        <div class="col-3">
          <label for="leadPilot">Lead Pilot</label>
          <select id="leadPilot"></select>
        </div>
        <div class="col-3">
          <label for="monkeyLead">Monkey Lead</label>
          <select id="monkeyLead"></select>
        </div>
        <div class="col-12">
          <label for="showNotes">Notes for the show</label>
          <textarea id="showNotes" placeholder="High-level notes"></textarea>
        </div>
      </div>
    </section>

    <section class="panel" aria-labelledby="entryTitle">
      <h2 id="entryTitle">Entry form</h2>
      <div class="grid" id="entryForm">
        <div class="col-2">
          <label for="unitId"><span id="unitLabel">Monkey</span> ID</label>
          <select id="unitId"></select>
          <div class="error" id="errUnit" hidden>Required</div>
        </div>
        <div class="col-2">
          <label for="planned">Planned to fly</label>
          <select id="planned">
            <option value="">Select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
          <div class="error" id="errPlanned" hidden>Required</div>
        </div>
        <div class="col-2">
          <label for="launched">Launched</label>
          <select id="launched">
            <option value="">Select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
          <div class="error" id="errLaunched" hidden>Required</div>
        </div>
        <div class="col-4">
          <label>Status</label>
          <div class="pills" role="group" aria-label="Status">
            <button type="button" class="pill completed" id="stCompleted" data-status="Completed" aria-pressed="false"><span class="status-dot dot-success"></span>Completed</button>
            <button type="button" class="pill nolaunch" id="stNoLaunch" data-status="No-launch" aria-pressed="false"><span class="status-dot dot-danger"></span>No-launch</button>
            <button type="button" class="pill abort" id="stAbort" data-status="Abort" aria-pressed="false"><span class="status-dot dot-warn"></span>Abort</button>
          </div>
          <div class="error" id="errStatus" hidden>Required</div>
        </div>
        <div class="col-4 issue-block hidden">
          <label for="primaryIssue">Primary issue</label>
          <select id="primaryIssue"></select>
          <div class="error" id="errPrimary" hidden>Required</div>
        </div>
        <div class="col-4 issue-block hidden">
          <label for="subIssue">Sub-issue</label>
          <select id="subIssue"></select>
        </div>
        <div class="col-4 issue-block hidden" id="otherDetailWrap">
          <label for="otherDetail">Other detail</label>
          <input id="otherDetail" type="text" placeholder="Short detail" />
          <div class="error" id="errOther" hidden>Required</div>
        </div>
        <div class="col-4 issue-block hidden">
          <label for="severity">Severity</label>
          <select id="severity">
            <option value="">Select</option>
            <option>Critical show stop</option>
            <option>Major visible</option>
            <option>Minor contained</option>
          </select>
          <div class="error" id="errSeverity" hidden>Required</div>
        </div>
        <div class="col-4 issue-block hidden">
          <label for="rootCause">Root cause draft</label>
          <select id="rootCause">
            <option value="">Select</option>
            <option>Hardware</option>
            <option>Software</option>
            <option>Ops</option>
            <option>Environment</option>
            <option>Unknown</option>
          </select>
        </div>
        <div class="col-12 issue-block hidden">
          <label>Actions taken</label>
          <div class="actions-chips" id="actionsChips" role="group" aria-label="Actions taken"></div>
        </div>
        <div class="col-3">
          <label for="operator">Operator</label>
          <select id="operator"></select>
        </div>
        <div class="col-3">
          <label for="batteryId">Battery ID</label>
          <input id="batteryId" type="text" placeholder="e.g., B-12" />
        </div>
        <div class="col-3">
          <label for="delaySec">Launch delay seconds</label>
          <input id="delaySec" type="number" step="0.1" min="0" placeholder="0.0" />
          <div class="error" id="errDelay" hidden>Must be a non-negative number</div>
        </div>
        <div class="col-3">
          <label for="commandRx">Command received</label>
          <select id="commandRx">
            <option value="">Select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
        <div class="col-9">
          <label for="entryNotes">Notes</label>
          <input id="entryNotes" type="text" placeholder="Short note" />
        </div>
      </div>
    </section>

    <section id="groups"></section>
  </div>

  <div class="sticky-footer" role="contentinfo">
    <div class="footer-grid">
      <button id="newShow" class="btn span-3">New Show</button>
      <button id="dupShow" class="btn span-3">Duplicate Current Show</button>
      <button id="addLine" class="btn primary span-3">Add line</button>
      <button id="exportCsv" class="btn ghost span-3">Export CSV</button>
      <button id="exportJson" class="btn ghost span-3">Export JSON</button>
    </div>
  </div>

  <div id="editModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="editTitle">
    <div class="modal">
      <div class="toolbar">
        <h2 id="editTitle">Edit entry</h2>
        <button id="closeEdit" class="btn icon-btn" title="Close edit">✖️</button>
      </div>
      <form id="editForm" class="grid"></form>
      <div class="sep"></div>
      <div class="row" style="justify-content:flex-end;gap:10px;">
        <button type="button" id="saveEdit" class="btn primary">Save changes</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="./app.js" type="module"></script>
</body>
</html>
